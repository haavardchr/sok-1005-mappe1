---
title: "Mappeoppgave 1"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(zoo)
library(tidyverse)
library(data.table)
library(cowplot)
```

# Oppgave 1

```{r}
Global_temp <- fread("http://vortex.nsstc.uah.edu/data/msu/v6.0/tlt/uahncdc_lt_6.0.txt", sep = " ")
View(Global_temp)

Global_temp <- Global_temp[-c(518:526),]
str(Global_temp)

Global_temp <- as.data.frame(apply(Global_temp, 2, as.numeric))
str(Global_temp)
```

Først laster jeg inn data fra "Lower Troposphere" hvor jeg også fjerner de siste 8 radene med data, etter som dette ikke er verdifullt å ha med i tabellen. I tillegg endrer jeg dataen fra "character" verdier til numeriske verdier slik at utregningen blir enklere. 

```{r}
keeps <- c("Year", "Mo", "Globe")
Global_temp <- Global_temp[keeps]

Global_temp1 <- Global_temp %>% 
  arrange(Year) %>% 
  group_by(Year) %>% 
  mutate(yearmean = rollmean(Globe, k = 12, fill = NA)) %>% 
  ungroup()

Global_temp2 <- Global_temp1 %>% drop_na()
Global_temp2 <- Global_temp2 %>% 
  rename(Filler = Globe,
         Globe=yearmean)

Global_temp2 %>% 
  ggplot(aes(x = Year, y = Globe)) +
  geom_line(colour = "red") +
  labs(title = "Temperaturendring over tid i troposfæren",
       x = "År",
       y = "Årlig temperatur snitt")

Global_temp1 %>% 
  ggplot(aes(x = Year, y = Globe)) +
  geom_line(color = "blue") + geom_point(color= "blue") +
  labs(title = "Temperaturendring hver måned",
       x = "År",
       y = "Temperatur i snitt")
```
Deretter lager jeg to plot. En som bruker funksjonen "rollmean" fra Zoo. For å lage årlige snitt, og en for hver måned i alle årene.

# Oppgave 2

```{r}
Lower_Trop <- fread("https://www.nsstc.uah.edu/data/msu/v6.0/tlt/uahncdc_lt_6.0.txt", sep = " ")
Lower_Trop <- Lower_Trop[-c(518)]
Lower_Trop <- as.data.frame(apply(Lower_Trop, 2, as.numeric))

Mid_Trop <- fread("https://www.nsstc.uah.edu/data/msu/v6.0/tmt/uahncdc_mt_6.0.txt", sep = " ")
Mid_Trop <- Mid_Trop[-c(518)]
Mid_Trop <- as.data.frame(apply(Lower_Trop, 2, as.numeric))

Trop <- fread("https://www.nsstc.uah.edu/data/msu/v6.0/ttp/uahncdc_tp_6.0.txt", sep = " ")
Trop <- Trop[-c(518)]
Trop <- as.data.frame(apply(Trop, 2, as.numeric))

Lower_Strat <- fread("https://www.nsstc.uah.edu/data/msu/v6.0/tls/uahncdc_ls_6.0.txt" , sep = " ")
Lower_Strat <- as.data.frame(apply(Lower_Strat, 2, as.numeric))
```

Henter inn data fra alle tabellene og lagrer de som nye variabler. Deretter lager jeg et plot for hver ved bruk av NoPol verdiene, samt også en for gjennomsnittet, og plotter disse i lag ved bruk av Cowplot.

```{r}
keep <- c("Year", "Mo", "NoPol")
Lower_Trop <- Lower_Trop[keep]
Mid_Trop <- Mid_Trop[keep]
Trop <- Trop[keep]
Lower_Strat <- Lower_Strat[keep]

p1 <- Lower_Trop %>% 
  ggplot(aes(x = Year, y = NoPol)) +
  geom_line(col = "dark green") +
  geom_point(col = "dark green") +
  labs(title = "Nedre troposfære",
       x = "År",
       y = "Temperatur")

p2 <- Mid_Trop %>% 
  ggplot(aes(x = Year, y = NoPol)) +
  geom_line(col = "blue") +
  geom_point(col = "blue") +
  labs(title = "Midt troposfære",
       x = "År",
       y = "Temperatur")

p3 <- Trop %>% 
  ggplot(aes(x = Year, y = NoPol)) +
  geom_line(col = "red") +
  geom_point(col = "red") +
  labs(title = "Troposfære",
       x = "År",
       y = "Temperatur")

p4 <- Lower_Strat %>% 
  ggplot(aes(x = Year, y = NoPol)) +
  geom_line(col = "yellow") +
  geom_point(col = "yellow") +
  labs(title = "Nedre stratosfære",
       x = "År",
       y = "Temperatur")

library(data.table)

Snitt <- rbindlist(list(Lower_Trop, Mid_Trop, Trop, Lower_Strat))[,lapply(.SD,mean), list(Year, Mo)]

p5 <- Snitt %>% 
  ggplot(aes(x = Year, y = NoPol)) +
  geom_line(col = "black") +
  geom_point(col = "black") +
  labs(title = "Snitt temperatur",
       x = "År",
       y = "Temperatur")

plot_grid(p1, p2, p3, p4, p5, ncol = 2, labels = "AUTO")
```

